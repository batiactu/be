var prevP=0,nextP=0;function _validateEmail(b){var a=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;if(a.test(b)){return true}else{return false}}function transfert_ami(a,b){postuler(a,b,1)}function postuler(a,d,e){email=$("#"+d+" #email").val();if(!$("#"+d).valid()){setTimeout(function(){$("#waiting_send").popup("close")},200);return false}if($.trim(email).length==0||!_validateEmail(email)){setTimeout(function(){$("#waiting_send").popup("close")},200);return false}else{$("#"+a).popup("close");id_annonce=$("#annonce #"+d+" #id_annonce").val();var b=$("#annonce #"+d+" #subject").val();var c=$("#annonce #"+d+" #message").val();if(e){wrp_cpt_mobile("form-envoi-annonce-ami",id_annonce)}else{wrp_cpt_mobile("form-auto-transfert",id_annonce)}if(e){$.jStorage.set("emailami",email)}else{$.jStorage.set("email",email)}$.jStorage.reInit();$.mobile.loading("show");$.ajax({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,put:"candidate-annonce",id:id_annonce,email:email,subject:b,message:c,istransfertami:e},dataType:"jsonp",async:true,success:function(f){$.mobile.loading("hide");if(f=="OK"){var g="Cette annonce a bien été envoyée à "+email;setTimeout(function(){$("#waiting_send").popup("close")},200);setTimeout(function(){if(e){$("#confirm_send_ami").popup({history:false});$("#confirm_send_ami").popup("open");wrp_cpt_mobile("form-envoi-annonce-ami-success",id_annonce)}else{$("#confirm_send").popup({history:false});$("#confirm_send").popup("open");wrp_cpt_mobile("form-auto-transfert-success",id_annonce)}},300)}else{var g="Une erreur est survenue!";setTimeout(function(){$("#waiting_send").popup("close")},200);setTimeout(function(){$("#error_send").popup({history:false});$("#error_send").popup("open");if(e){wrp_cpt_mobile("form-envoi-annonce-ami-error",id_annonce)}else{wrp_cpt_mobile("form-auto-transfert-error",id_annonce)}},300)}},error:function(){$.mobile.loading("hide");var f="Une erreur est survenue!";setTimeout(function(){$("#waiting_send").popup("close")},200);setTimeout(function(){$("#error_send").popup({history:false});$("#error_send").popup("open");if(e){wrp_cpt_mobile("form-envoi-annonce-ami-error",id_annonce)}else{wrp_cpt_mobile("form-auto-transfert-error",id_annonce)}},300)}})}return true}function showAnnonce(e,c){var d=/(?:.*id={1})+(\d+)(.*)/g;d.exec(e.hash);if(RegExp.$1!=""){var h=RegExp.$1}var a=0;if(search_list_id){a=search_list_id.length}else{search_list_id=new Array}var g=search_list_id.indexOf(h.toString());prevP=g>0?search_list_id[g-1]:null;nextP=g<a-1?search_list_id[g+1]:null;var f=e.hash.replace(/\?.*$/,"");var b=$(f);$(f).getItem({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,get:"annonce",id_annonce:h,PREVIOUS:prevP,NEXT:nextP}});c.dataUrl=e.href;$.mobile.changePage(b,c)}function _refresh_datas(){var a=$.jStorage.get("email");if(!a){a=""}$("#popupPostuler #email").val(a);var b=$.jStorage.get("emailami");if(!b){b=""}$("#popupTransfertAmi #email").val(b)};