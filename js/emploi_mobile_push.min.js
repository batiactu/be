var appliName="EmploiBatiactuMobile";var appliVersion="1.1.0";var registerServeur=DIRSCRIPTS;var registerUrlInterface="interface-mobile.php";var batiMP=null;function successHandlerIOS(a){batiMP.log(typeof a,"DEBUG");if(typeof a=="string"){registerPush(a,{})}else{batiMP.log("Une erreur est survenue, veuillez rÃ©ssayer","ERROR")}}function errorHandlerIOS(a){batiMP.log("errorHandlerIOS","ERROR")}function onNotificationIOS(a){batiMP.log("onNotificationIOS","DEBUG");createPushItemFromIOS(a)}function createPushItemFromIOS(d){var e="Reception notification :";if(typeof d.title!="undefined"){e=d.title}var a="";if(typeof d.alerte!="undefined"){a=d.idAlerte}var b="";if(d.alert){b=d.alert}var c=[];if(typeof d.idAlerte!="undefined"){c.idAlerte=d.idAlerte}if(typeof d.idAlerte!="undefined"){c.nbAlerte=d.nbAlerte}createPushItem(e,b,c)}function successHandlerAndroid(a){batiMP.log("successHandlerAndroid","DEBUG")}function errorHandlerAndroid(a){batiMP.log("errorHandlerAndroid","ERROR")}function onNotificationAndroid(a){batiMP.log("Evenement : "+a.event,"DEBUG");switch(a.event){case"registered":if(a.regid.length>0){registerPush(a.regid,{})}break;case"message":createPushItemFromAndroid(a.payload);break;case"error":batiMP.log(a.msg,"ERROR");break;default:batiMP.log("Evenement inconnu"+a.msg,"DEBUG");break}}function createPushItemFromAndroid(c){var d="Reception notification :";if(typeof c.title!="undefined"){d=c.title}var b=[];if(typeof c.idAlerte!="undefined"){b.idAlerte=c.idAlerte}if(typeof c.idAlerte!="undefined"){b.nbAlerte=c.nbAlerte}var a="";if(typeof c.message!="undefined"){a=c.message}createPushItem(d,a,b)}function deviceIsReadyForPush(){batiMP=new batiactuMobilePush();batiMP.registerSuffix=true;batiMP.unRegisterSuffix=false;batiMP.senderID="211095738121";batiMP.setDebug(true,"ee");batiMP.log("applel device ready","DEBUG");is_ios=batiMP.is_ios();is_android=batiMP.is_android();listePush=batiMP.getAllNotifications();if(listePush.length>0){afficheNotifs(listePush)}majInfoPush();var a=batiMP.getPushToken();batiMP.log(a,"DEBUG");if(a!=null){try{batiMP.registerDevice("successHandler","errorHandler","onNotification")}catch(b){batiMP.log(b.message,"ERROR")}}batiMP.log("Fin device ready")}function createPushItem(d,b,c){var a={titre:d,message:b,data:c};batiMP.addNotification(a);effaceNotifs();afficheNotifs(batiMP.getAllNotifications())}function afficheNotifs(a){alertNotif();$("#resultat-mes-recherches").trigger("pagebeforeshow")}function alertNotif(){$(":mobile-pagecontainer").pagecontainer("change","#dialog-push-received",{role:"dialog"})}function effaceNotifs(){}function majInfoPush(){var a=batiMP.getPushToken();maj_panel("")}function successHandlerUnRegister(a){unRegisterPush()}function errorHandlerUnRegister(a){}function onSuccess(a){$("#app-status-ul").append(a);if(typeof a.success=="undefined"||a.success=="false"){console.log("Une erreur est survenu")}}function onError(b,c,a){batiMP.log("Erreur Ajax","DEBUG")}function unRegisterPush(){var a=batiMP.getPushToken();if(a!=null){$.ajax({url:registerServeur+registerUrlInterface,data:{json:1,appli:appliName,ver:appliVersion,put:"unregister_push",token:a},dataType:"json",crossDomain:true,type:"POST",success:onSuccess,error:onError});batiMP.setPushToken("");majInfoPush()}}function merge_options(d,c){var b={};for(var a in d){b[a]=d[a]}for(var a in c){b[a]=c[a]}return b}function registerPush(a,c){var b=device.uuid;dataToSend=merge_options({json:1,appli:appliName,ver:appliVersion,put:"register_push",token:a,uuid:b},c);batiMP.log(registerServeur+registerUrlInterface,"URL");$.ajax({url:registerServeur+registerUrlInterface,data:dataToSend,dataType:"json",crossDomain:true,type:"POST",success:onSuccess,error:onError});batiMP.setPushToken(a);if(dataToSend.put=="register_push"){majInfoPush()}}$(document).bind("pagecreate",function(){$("#app-status-ul").parent().parent().append('<button id="hideB" style="display:none;">Cacher le Debug </button></li>');$("#app-status-ul").parent().parent().append('<button id="showB">Afficher le Debug </button></li>');$("#registerpush").bind("tap",function(c,d){if(!is_device){var a={titre:"Titre du message",message:"message"};var e={titre:"No device detected",message:"Vous devez utiliser un smartphone IOS ou Android"};listePush.push(a);listePush.push(e);effaceNotifs();afficheNotifs(listePush)}if(is_device&&(batiMP.getPushToken()==null)){batiMP.log("Button register: demande de register","DEBUG");batiMP.registerDevice("successHandler","errorHandler","onNotification")}var b=$("#flux_rss").val();if(is_device&&b!=""){batiMP.log("Button register: demande d'alerte","DEBUG");registerPush(batiMP.getPushToken(),{cmd:"add_push_alert",alerte_emploi:b})}$("#registerpush").trigger("create")});$("#unregisterpush").bind("tap",function(a,b){if(is_device&&batiMP.getPushToken()!=null){batiMP.unRegisterDevice("successHandlerUnRegister","errorHandlerUnRegister")}});$("#hideB").bind("tap",function(a,b){a.preventDefault();$("#app-status-ul").hide();$("#hideB").hide();$("#showB").show()});$("#showB").bind("tap",function(a,b){a.preventDefault();$("#app-status-ul").show();$("#hideB").show();$("#showB").hide()})});