var DIRHTTP="http://www.batiactuemploi.com/";var DIRSCRIPTS="http://bo.v2.batiactuemploi.com/scripts/";var pageinit=false;var back_popup_hash="";var use_infinite=true;var Tfonctions_search=new Array;var Tregions_search=new Array;var Texperiences_search=new Array;var Tcontrats_search=new Array;var Tregions=new Array;var Tdepts=new Array;var Tfonctions=new Array;var Texperiences=new Array;var Tcontrats=new Array;var Limit_Annonce=200;var Limit_Recherche=50;var nb_results_by_page=20;var current_zonegeo=new Array;var current_fonction=new Array;var current_metier=new Array;var current_experience=new Array;var current_contrat=new Array;var current_motclef="";var hash_searh_selected_to_del="";var current_nb_annonce=0;var last_search=new Object();var search_list_id=new Array;var nb_annonce=2200;var nb_annonce_cent_inf=(nb_annonce-nb_annonce%100);tsearchs=new Object();var notify=function(b,c,d){var a=$('<p style="display:none;">'+b+"</p>");$(c+" .notifications").each(function(){if(d==null){d=3000}$(this).append(a);a.slideDown(300,function(){window.setTimeout(function(){a.slideUp(300,function(){a.remove()})},d)})})};var remove_notify=function(a){$(a+" .notifications").find("p").remove()};function pagination(c){var a=Math.ceil(current_nb_annonce/nb_results_by_page);var b=Math.floor(c/nb_results_by_page);if(b<a){$("#recherche #pagin-next").show();$("#recherche #pagin-next").removeClass("ui-disabled")}else{$("#recherche #pagin-next").hide();$("#recherche #pagin-next").addClass("ui-disabled")}if(b>1){$("#recherche #pagin-prev").show();$("#recherche #pagin-prev").removeClass("ui-disabled")}else{$("#recherche #pagin-prev").hide();$("#recherche #pagin-prev").addClass("ui-disabled")}$("#recherche #pagin-pages").html(b+"/"+a);$("#recherche .ui-select").css("display","none");$("#recherche #select-page").html("");$("#recherche #select-page").append('<option value="0">Aller à la page</option>');for(i=1;i<=a;i++){if(i!=b){$("#recherche #select-page").append('<option value="'+i+'">page '+i+"</option>")}}if(a>1){$("#recherche #select-page").selectmenu("refresh",true);$("#recherche .ui-select").css("display","inline");$("#recherche #pagin-pages").css("display","inline")}}function uncheck_cac(b,a){window["current_"+b]=new Array;$(".check"+b).each(function(){if(this.id!=a.attr("id")){$(this).prop("checked",false)}$(this).checkboxradio().checkboxradio("refresh")});if(a.prop("checked")){window["current_"+b].push(a.attr("value"))}}function view_list_mes_recherches(){$("#resultat-mes-recherches").completeListMesRecherches({})}function reset_search(a){current_zonegeo=new Array;current_fonction=new Array;current_metier=new Array;current_experience=new Array;current_contrat=new Array;current_motclef="";current_nb_annonce=0;$("[id^=selected-detail-page-]").text("");$("[id=recherche-detail-mot-clef]").val("");$(".check_cac").each(function(){$(this).prop("checked",false);$(this).checkboxradio().checkboxradio("refresh")});if(a){$.mobile.changePage("#recherche-detail")}}function saved_last_search(){criteres_last_search=new Object();criteres_last_search.current_zonegeo=current_zonegeo;criteres_last_search.current_fonction=current_fonction;criteres_last_search.current_experience=current_experience;criteres_last_search.current_contrat=current_contrat;criteres_last_search.current_motclef=current_motclef;$.jStorage.set("last_search",criteres_last_search)}function saved_search(){tsearchs=$.jStorage.get("tsearchs");if(!tsearchs){tsearchs=new Object()}var a=new Object();a.current_zonegeo=current_zonegeo;a.current_fonction=current_fonction;a.current_experience=current_experience;a.current_contrat=current_contrat;a.current_motclef=current_motclef;var b=convert_array_to_hash(a);if(tsearchs.hasOwnProperty(b)){$("#popupAlreadyExistsSaveSearch").popup("open")}else{tsearchs[b]=a;$.jStorage.set("tsearchs",tsearchs);$("#popupSaveSearch").popup("open")}}function convert_array_to_hash(b){var c=[];$.each(b,function(e,d){if(e!="push"){var f=e+":"+d;c.push(f)}});var a=c.join(", ");return a.hashCode()}String.prototype.hashCode=function(){var c=0,b,a;nb=this.length;if(nb==0){return c}for(b=0,l=nb;b<l;b++){a=this.charCodeAt(b);c=((c<<5)-c)+a;c|=0}return c};function gotosearch(a){if(load_searh_from_hash(a)){go_url_recherche();return false}else{alert("erreur");return false}}function select_del_search_from_hash(a){hash_search_selected_to_del=a;$("#confirmDeleteSearch").popup();$("#confirmDeleteSearch").popup("open",{history:false})}function candel_del_search(){hash_search_selected_to_del=""}function del_searh_from_hash(a){tsearchs=$.jStorage.get("tsearchs");if(!tsearchs){tsearchs=new Object()}if(tsearchs.hasOwnProperty(a)){notify("Suppression...","#mes-recherches");delete tsearchs[a];$.jStorage.set("tsearchs",tsearchs);$("#mes-recherches #resultat-mesrecherches").hide();view_list_mes_recherches();$("#mes-recherches #resultat-mesrecherches").show();$("#mes-recherches").trigger("create");return true}else{notify("Erreur, ce hash ne correspond pas!","#mes-recherches");return false}}function load_searh_from_hash(a){tsearchs=$.jStorage.get("tsearchs");if(!tsearchs){tsearchs=new Object()}if(tsearchs.hasOwnProperty(a)){notify("Rechargement","#mes-recherches")}else{notify("Erreur, ce hash ne correspond pas!","#mes-recherches");return false}reset_search();criteres_search_current_hash=tsearchs[a];$.each(criteres_search_current_hash,function(b,c){window[b]=c});set_fields_from_current();return true}function saved_object_search(a){tsearchs=$.jStorage.get("tsearchs");if(!tsearchs){tsearchs=new Object()}var b=convert_array_to_hash(a);tsearchs[b]=a;$.jStorage.set("tsearchs",tsearchs)}function switch_alert_from_search(b,c){tsearchs=$.jStorage.get("tsearchs");if(!tsearchs){tsearchs=new Object()}if(!tsearchs.hasOwnProperty(c)){notify("Erreur, ce hash ne correspond pas!","#mes-recherches");return false}if(typeof tsearchs[c]["push"]!="undefined"&&tsearchs[c]["push"]==true){tsearchs[c]["push"]=false;if(is_device){batiMP.log("Désactivation alerte hash :"+c,"DEBUG");registerPush(batiMP.getPushToken(),{put:"supp_push_alert",local_hash:c})}$(b).buttonMarkup({theme:"d"})}else{tsearchs[c]["push"]=true;var a={};a.fonction=tsearchs[c]["current_fonction"];a.zonegeo=tsearchs[c]["current_zonegeo"];a.motclef=tsearchs[c]["current_motclef"];if(is_device){batiMP.log("Activation alerte hash :"+c,"DEBUG");registerPush(batiMP.getPushToken(),{put:"add_push_alert",local_hash:c,alerte:a})}$(b).buttonMarkup({theme:"a"})}saved_object_search(tsearchs[c])}function set_fields_from_current(){$("[id^=selected-detail-page-]").html("");$.each(current_zonegeo,function(a){value=current_zonegeo[a];var b="zonegeo";$("[cac_type="+b+"][value="+value+"]").attr("id");$("[cac_type="+b+"][value="+value+"]").prop("checked",true);$("[cac_type="+b+"][value="+value+"]").checkboxradio().checkboxradio("refresh");var c=get_value_by_key(Tregions,value);$("#selected-detail-page-"+b).html(c)});$.each(current_fonction,function(a){value=current_fonction[a];var b="fonction";$("[cac_type="+b+"][value="+value+"]").attr("id");$("[cac_type="+b+"][value="+value+"]").prop("checked",true);$("[cac_type="+b+"][value="+value+"]").checkboxradio().checkboxradio("refresh");var c=get_value_by_key(Tfonctions,value);$("#selected-detail-page-"+b).html(c)});$.each(current_contrat,function(a){value=current_contrat[a];var b="contrat";$("[cac_type="+b+"][value="+value+"]").attr("id");$("[cac_type="+b+"][value="+value+"]").prop("checked",true);$("[cac_type="+b+"][value="+value+"]").checkboxradio().checkboxradio("refresh");var c=get_value_by_key(Tcontrats,value);$("#selected-detail-page-"+b).html(c)});$.each(current_experience,function(a){value=current_experience[a];var b="experience";$("[cac_type="+b+"][value="+value+"]").attr("id");$("[cac_type="+b+"][value="+value+"]").prop("checked",true);$("[cac_type="+b+"][value="+value+"]").checkboxradio().checkboxradio("refresh");var c=get_value_by_key(Texperiences,value);$("#selected-detail-page-"+b).html(c)});$("#recherche-detail-mot-clef").val(current_motclef)}function get_current_search_wreport(e){if(typeof(e)=="undefined"||e==null||e==undefined){e=0}var b="";var a="";var d="zonegeo";a+=d+" : "+current_zonegeo.join(",")+"	";b+=d+" : ";var c=0;$.each(current_zonegeo,function(f){value=current_zonegeo[f];if(c>0){b+=","}b+=get_value_by_key(Tregions,value);c++});b+="	";d="fonction";a+=d+" : "+current_fonction.join(",")+"	";b+=d+" : ";c=0;$.each(current_fonction,function(f){value=current_fonction[f];if(c>0){b+=","}b+=get_value_by_key(Tfonctions,value);c++});b+="	";d="contrat";a+=d+" : "+current_contrat.join(",")+"	";b+=d+" : ";c=0;$.each(current_contrat,function(f){value=current_contrat[f];if(c>0){b+=","}b+=get_value_by_key(Tcontrats,value);c++});b+="	";d="experience";a+=d+" : "+current_experience.join(",")+"	";b+=d+" : ";c=0;$.each(current_experience,function(f){value=current_experience[f];if(c>0){b+=","}b+=get_value_by_key(Texperiences,value);c++});b+="	";d="motclef";a+=d+" : "+current_motclef+"	";b+=d+" : "+current_motclef+"	";if(e){return b}else{return a}}function get_value_by_key(b,a){return(b[a]===undefined)?"":b[a]}function load_last_searh(){reset_search(true);criteres_last_search=$.jStorage.get("last_search");$.each(criteres_last_search,function(a,b){window[a]=b});set_fields_from_current()}function init_global(){$.ajax({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,get:"zone-geo"},dataType:"jsonp",async:false,cache:false}).done(function(b){Tregions_search=new Array;var a=0;for(code in b){label=b[code];Tregions_search.push({item_value:code,item_label:label,item_index:a,type:"zonegeo"});Tregions[code]=label;a++}});$.ajax({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,get:"nb_annonce"},dataType:"jsonp",async:false,cache:false,success:function(a){nb_annonce=a.nb;nb_annonce_cent_inf=(nb_annonce-nb_annonce%100);$("#nbannonce_cent_inf").text(nb_annonce_cent_inf)},error:function(a){}});$.ajax({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,get:"fonction"},dataType:"jsonp",async:false,cache:false}).done(function(b){Tfonctions_search=new Array;Tfonctions=new Array;var a=0;for(item in b){for(fonction in b[item]["fonction"]){label=b[item]["fonction"][fonction];Tfonctions_search.push({item_value:fonction,item_label:label,item_index:a,type:"fonction"});Tfonctions[fonction]=label;a++}}});$.ajax({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,get:"dept"},dataType:"jsonp",async:false,cache:false}).done(function(b){Tdepts=new Array;var a=0;for(code in b){label=b[code];Tdepts[code]=label;a++}});load_contrats();load_experiences();initSearch();return true}function initSearch(){tsearchs=$.jStorage.get("tsearchs");if(!tsearchs){tsearchs=new Object()}search_list_id=new Array;criteres_last_search=$.jStorage.get("last_search")}function load_contrats(){$.ajax({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,get:"contrat"},dataType:"jsonp",async:false,cache:false}).done(function(c){var b=Handlebars.compile($("#recherche-detail-tpl").html());Tcontrats_search=new Array;Tcontrats=new Array;var a=0;for(code in c){label=c[code];Tcontrats_search.push({item_value:code,item_label:label,item_index:a,type:"contrat"});Tcontrats[code]=label;a++}$("#recherche-detail-contrat").html(b(Tcontrats_search))})}function load_experiences(){$.ajax({url:DIRSCRIPTS+"interface-mobile.php",data:{jsonp:1,get:"experience"},dataType:"jsonp",async:false,cache:false}).done(function(c){var b=Handlebars.compile($("#recherche-detail-tpl").html());Texperiences_search=new Array;Texperiences=new Array;var a=0;for(code in c){label=c[code];Texperiences_search.push({item_value:code,item_label:label,item_index:a,type:"experience"});Texperiences[code]=label;a++}$("#recherche-detail-experience").html(b(Texperiences_search))})}function launchSearch(e,k){search_list_id=new Array;if(e==null){e=false}var a=$("#recherche-detail-mot-clef").val();var d="";var c="";var h="";var m="";var j="";if(e){$.each(current_zonegeo,function(n){if(j!=""){j+="|"}j+=this});$.each(current_fonction,function(n){if(d!=""){d+="|"}d+=this})}else{var j=$("#accueil #zone-geo").val()}current_motclef=$("[id=recherche-detail-mot-clef]").val();if(k){var g=(k-1)*nb_results_by_page;var f=g+nb_results_by_page}else{var g=parseInt($("#recherche #next").attr("data-next"));var f=g+nb_results_by_page}if(g>Limit_Annonce){$("#recherche #next").attr("data-next",g);f=Limit_Annonce}else{if(g>current_nb_annonce){$("#recherche #next").attr("data-next",g);f=current_nb_annonce}else{$("#recherche #next").attr("data-next",f)}}var b=$("#recherche").children(":jqmData(role=content)");b.find("#nb_results").html("<br />");b.find("#pagin-prev").css("display","none");b.find("#pagin-next").css("display","none");b.find("#pagin-pages").css("display","none");$("#select-page").parents(".ui-select").css("display","none");b.find(".btn_display1").css("display","none");b.find(".btn_display2").css("display","none");$("#resultat-recherche").completeListItem({url:DIRSCRIPTS+"interface-mobile.php",data:{get:"search",jsonp:1,mot:a,zonegeo:j,fonction:d,metier:c,experience:h,contrat:m,length:f}});if(use_infinite){$("#resultat-recherche").show()}saved_last_search();return false}function execute_search(c,b){var d=c.hash.replace(/\?.*$/,"");var a=$(d);if(!use_infinite){launchSearch(1,1)}a.page();b.dataUrl=c.href;$.mobile.changePage(a,b);if(b.noLoading==null){$.mobile.loading("show")}}function check_params(){save_current_criteres();go_url_recherche()}function go_url_recherche(){var a=$("#recherche").children(":jqmData(role=content)");a.find("#resultat-recherche").html("");a.find("#nb_results").html("<br />");a.find("#pagin-prev").css("display","none");a.find("#pagin-next").css("display","none");a.find("#pagin-pages").css("display","none");$("#select-page").parents(".ui-select").css("display","none");a.find(".btn_display1").css("display","none");a.find(".btn_display2").css("display","none");$("#recherche #next").addClass("displaynone");newurl="#recherche?zone="+current_zonegeo.join("-")+"&fct="+current_experience.join("-")+current_contrat.join("-")+current_fonction.join("-")+"&motclef="+current_motclef;$.mobile.changePage(newurl);return true}function save_current_criteres(){if($(".checkzonegeo").lenght>0){current_zonegeo=new Array;$(".checkzonegeo").each(function(a){if($(this).prop("checked")){current_zonegeo.push($(this).val())}})}if($(".checkfonction").lenght>0){current_fonction=new Array;$(".checkfonction").each(function(a){if($(this).prop("checked")){current_fonction.push($(this).val())}})}if($(".checkcontrat").lenght>0){current_contrat=new Array;$(".checkcontrat").each(function(a){if($(this).prop("checked")){current_contrat.push($(this).val())}})}if($(".checkexperience").lenght>0){current_experience=new Array;$(".checkexperience").each(function(a){if($(this).prop("checked")){current_experience.push($(this).val())}})}current_motclef=$("[id=recherche-detail-mot-clef]").val();return false};