(function(a){a.fn.extend({completeListMesRecherches:function(c){var f={template:"#mes-recherches-resultat-tpl",url:"fill-url-source",data:{}};var c=a.extend(f,c);var e=a(this);var d=Handlebars.compile(a(c.template).html());if(c.noLoading==null){a.mobile.loading("show")}nb=Object.keys(tsearchs).length;e.html("");var b=new Array;a.each(tsearchs,function(l,n){var m=new Array;m.item_no_criteres="Recherche globale (sans critère)";for(k in n){m["item_lib_"+k]="";if(n[k]!=""){m.item_no_criteres=null}switch(k){case"current_zonegeo":if(n[k]==""){m["item_lib_"+k]=n[k]}else{if(typeof n[k]=="object"){a.each(n[k],function(p,q){m["item_lib_"+k]+='<span class="region">'+Tregions[q]+"</span>"})}}break;case"current_fonction":if(n[k]==""){m["item_lib_"+k]=n[k]}else{if(typeof n[k]=="object"){a.each(n[k],function(p,q){m["item_lib_"+k]+='<span class="fonction">'+Tfonctions[q]+"</span>"})}}break;case"current_experience":if(n[k]==""){m["item_lib_"+k]=n[k]}else{m["item_lib_"+k]=Texperiences[n[k]]}break;case"current_contrat":if(n[k]==""){m["item_lib_"+k]=n[k]}else{m["item_lib_"+k]=Tcontrats[n[k]]}break;case"push":m["item_"+k]=n[k];break;default:}m["item_"+k]=n[k]}m.item_hash=l;if(batiMP!==null&&batiMP.getAllNotifications()!=[]){var h=batiMP.getAllNotifications();var o=h.length;m.nbAlerte=0;for(g=o-1;g>=0;g--){if(h[g].data.idAlerte==l){m.nbAlerte+=parseInt(h[g].data.nbAlerte);break}}}b.push(m)});e.html(d(b));e.show();if(c.noLoading==null){remove_notify("#mes-recherches");a.mobile.loading("hide")}if(use_infinite){a.waypoints();a.waypoints("refresh")}},completeListItem:function(b){var e={template:"#recherche-resultat-tpl",url:"fill-url-source",data:{}};var b=a.extend(e,b);var d=a(this);var c=Handlebars.compile(a(b.template).html());if(b.noLoading==null){a.mobile.loading("show")}if(b.dataType==null){b.dataType="jsonp"}a.ajax({url:b.url,data:b.data,dataType:b.dataType,async:false}).done(function(m){data=m.TResults;nbTotal=m.nb;var h=new Array;if(b.dataType=="xml"){xml=data;data=new Array;a("item",xml).each(function(o){var n=blank.clone();n.removeAttr("id");ligne=n.html();a("*",this).each(function(p,r){k=r.tagName;v=a(r).text();if(k=="enclosure"){v=a(r).attr("url");k="image"}var q=new RegExp("item_"+k+"","gi");ligne=ligne.replace(q,v)});n.html(ligne);n.show();d.append(n)})}else{nb=data.length;a.each(data,function(p,t){var o=p>0?data[p-1]["origine"]:null;var s=p<nb-1?data[p+1]["origine"]:null;var r=new Array;search_list_id.push((data[p]["origine"]).toString());for(k in t){switch(k){case"region":r["item_lib_"+k]="";var n=t[k]+"";var q=n.split(",");for(j in q){if(r["item_lib_"+k]!=""){r["item_lib_"+k]+=","}r["item_lib_"+k]+=Tregions[q[j]]}break;case"dept":r["item_lib_"+k]="";var n=t[k]+"";var q=n.split(",");for(j in q){if(r["item_lib_"+k]!=""){r["item_lib_"+k]+=","}r["item_lib_"+k]+=Tdepts[q[j]]}break;case"contrat":if(t[k]==""){t[k]="Tous contrats"}break}r["item_"+k]=t[k]}r.item_previous=o;r.item_next=s;h.push(r)})}current_nb_annonce=nbTotal;if(!use_infinite){var l=parseInt(a("#recherche #next").attr("data-next"));var f=l-nb_results_by_page-1;if(f<0){f=0}h=h.slice(f,l-1)}d.html(c(h));var i=a("#recherche").children(":jqmData(role=content)");i.find("#nb_results").removeClass("noresult");switch(nbTotal){case 0:res="Aucune offre d'emploi ne correspond à vos critères";i.find("#nb_results").addClass("noresult");break;case 1:res="1 offre d'emploi";break;case Limit_Annonce:res=nbTotal+" premières offres d'emploi";break;default:res=nbTotal+" offres d'emploi"}d.show();d.listview().listview("refresh");i.find("#nb_results").text(res);i.find(".btn_display1").css("display","block");if(nbTotal>nb_results_by_page){i.find(".btn_display2").css("display","block")}if(use_infinite&&nbTotal>=Limit_Annonce){a("#recherche #next").trigger("create");a("#recherche #next").button();if((current+nb_results_by_page)<=current_nb_annonce){a("#recherche #next").removeClass("displaynone")}else{a("#recherche #next").addClass("displaynone")}a("#recherche #next").trigger("create")}if(b.noLoading==null){remove_notify("#recherche");a.mobile.loading("hide")}if(use_infinite){a.waypoints();a.waypoints("refresh")}else{pagination(l);a.mobile.silentScroll(0)}})},getItem:function(c){var f={template:"#annonce-detail-tpl",itemtarget:"#annonce",url:"fill-url-source",data:{}};var c=a.extend(f,c);var e=a(this);var b=e.attr("id");var d=Handlebars.compile(a(c.template).html());a.mobile.loading("show");a.ajax({url:c.url,data:c.data,dataType:"jsonp",async:false,success:function(i){a(c.itemtarget+" :jqmData(role=footer)").remove();a(c.itemtarget+' :jqmData(class="content_annonce")').remove();a(c.itemtarget).append(d(i));_refresh_datas();var h=Handlebars.compile(a("#nav-annonce-detail-tpl").html());Tab=new Array;Tab.nav=[{PREVIOUS:prevP,NEXT:nextP}];TabComplete=new Array;TabComplete.push(Tab);a("#annonce #nav-annonce").remove();a("#annonce").append(h(TabComplete)).trigger("pagecreate");a("#annonce").trigger("create");a.mobile.loading("hide")},error:function(){a.mobile.loading("hide")}});return this}})})(jQuery);